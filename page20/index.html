
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>@yorzi</title>
  <meta name="author" content="Andy Wang">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://blog.wangyaodi.com/page20/index.html"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <link href="/atom.xml" rel="alternate" title="@yorzi" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11967621-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  

  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/" style="color:red">@yorzi</a></h1>
  
  <a href="https://github.com/yorzi/life_blog"><img style="position: absolute; top: 0; right: 0; border: 0;" src="/images/forkme.png" alt="Fork me on GitHub"></a>
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss email">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="wangyaodi@gmail.com" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:blog.wangyaodi.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="http://tech.wangyaodi.com">技术闲谈</a></li>
  <li><a href="http://about.me/wangyaodi">关于安迪</a></li>
  <li><a href="/blog/archives">博客存档</a></li>
  <li><a href="https://plus.google.com/108320517625960982177/about?hl=en" style="color:red">@yorzi</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">



  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/04/a-discussion-on-testing/">A Discussion on Testing</a></h1>
    
    
      <p class="meta">




<time datetime="2009-11-04 00:00:00 +0800" pubdate  updated >Nov 4<span>th</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p>In this week code review meeting, I open a discussion about testing code of Ruby on Rails. Actually I think the test for a complex system is not that easy if you wanna do it gracefully, but it&#8217;s still worth starting in small steps, that&#8217;s what&#8217;s important. I&#8217;d like to share the ideas people contributed, and the included contents are as following:<br />
Andy:
<blockquote>
Tried something new for RoR testing yesterday, it&#8217;s factory_girl(fixtures replacement solution. <a href="http://github.com/thoughtbot/factory_girl">see more details</a>). In this week code review, I show the testing code, and also have questions about test:</blockquote></p>




<p>1. How to make sure that you test all(99.5%) situations.<br />
2. If you test before you code, how to control/ensure the function points properly?</p>




<p>feel free to comment here if you have any thoughts on it.

I commented in front:
<blockquote>
My understanding of TEST:<br />
It means we should &#8220;program&#8221;(with mock and stub) one more time in different rule(based on the testing framework) to make sure features working correctly. but there is still a big chance to make mistake in both side(twice programming), so non-structured testing does not work very well. idea?
</blockquote>
Then Guolei&#8217;s view point:
<blockquote>
I don&#8217;t think writing test code is &#8220;twice programming&#8221;.<br />
1. Test code should be very plain and very simple. Mock and stub do make it complex, but there&#8217;s rarely case requiring mock and stub. If you find your test code is more complex that function code, then you are going wrong way.<br />
2. Actually writing test code can not be called &#8220;program&#8221;. It&#8217;s more like you are telling computer what it should do. It&#8217;s from the aspect of business logic, non with technique. So you should never make mistake when you get familiar with it, even so, it takes no time to fix it.<br />
3. The value of test code shines when refactoring code and for complex logic. I think Andy&#8217;s code is not a good example because the logic is so simple that there&#8217;s more test code than function code.
</blockquote>
Gary&#8217;s sample:
<blockquote>
Your test code is for a process. I would rather test a method one time, I this case I can try all possible input and test.<br />
for example:
</blockquote>
<pre name="code" class="ruby">
describe "article?" do
    it "should figure out the page is article type" do
      2.times do
        @page.page_parts.create
      end
      @page.article?.should == true
    end
    it "should figure out the page is not article type" do
      2.times do
        @page.page_parts.create(:group_id => 0)
      end
      @page.article?.should == false
    end
  end
</pre>
Then I posted:
<blockquote>
Yeah.. I don&#8217;t doubt about the value of writing test code, and I totally agree on what GL mentioned should be the basic principle of adding test code.</blockquote></p>




<p>The problem is, when I wanna cover all the situations/cases, there is, so far, no good way than writing lots of cases for it. so how to ensure it covering all the test-needed points, specially the business logic?<br />
It&#8217;s not something about which skills(mock and stub) should be used somehow, it&#8217;s about what should be test and how to make sure you fully test what you want to test.</p>




<p>For example in my test code, how to ensure it can fully test the Item model? if I missed points, is this test still believable? I know surely it should cover all situations as what we want, but how to make the coverage happened correctly? The test code may save my time and energy when refactoring or doing enhancement, but if it&#8217;s not that correctly covering the case, does it still play an important role?</p>




<p>I am a bit confused of the way we are testing the system rather than writing test code for specific function, any more ideas?

JP&#8217;s response followed up:
<blockquote>
As previously mentioned, I think its best to look at tests as a future investment, not a &#8220;I cover every point&#8221;. There are two types of &#8220;future investment&#8221;</blockquote></p>




<p>1. Immediate future. You are about to write some code (function) and you know how you want it to work and what the different possibilities are. You write the test code first and then code the function. Now, as you code the function, it is much faster to see if it works (this is especially true for complex logic like the content inputting system).</p>




<p>2. Further future. You have a list of &#8220;known&#8221; situations/cases. You might modify the working code in the future and in the future you might forget what all these different situations/cases are - but you know what they are right now. So, you write test code. Now, if you modify the code in the future and the tests still pass, you can feel comfortable that the code you modified did not break any &#8220;known&#8221; conditions.<br />
In both cases tests cannot find &#8220;unknown&#8221; cases&#8230;and I don&#8217;t think this is the point.</p>




<p>Two specific cases come to mind where I felt I used test code really well:<br />
a) Immediate Future: When first starting the Erlang queue system I wrote a number of test cases to simulate the trainer client&#8217;s various conditions. This allowed me to write the erlang code and then run a bunch of cases on it really quickly which saved a lot of time (otherwise I would have had to do lots and lots of clicks on the Trainer Client). Unfortunately, once the queue system started integrating all of the other apps and connecting to FS I could no longer find a reasonable way to keep these test cases to work (as so many things would have to be stubbed).</p>




<p>a) Further future: The old, old carb.rb model. This was incredibly complex (even from the beginning). I wrote test code after writing that model. Then, a few months later, made significant changes to that model but was able to use that test code to insure I covered all the conditions (this was before Andy started working on it).

Seven&#8217;s response:
<blockquote>
I&#8217;m only on the first step of writing test code, but it do helps me free my hands and ears from testing calls with FreeSWITCH. Nice.
</blockquote>
My last response:
<blockquote>
I think I got what I want from above discussion, thanks to all for sharing your view points or samples.
</blockquote></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/11/04/a-discussion-on-testing/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/03/ssh-turnl-script/">SSH Tunnel Script</a></h1>
    
    
      <p class="meta">




<time datetime="2009-11-03 00:00:00 +0800" pubdate  updated >Nov 3<span>rd</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p>Why SSH tunneling?</p>




<p>Obviously, if you live in Chxna or some other place where you are restricted to access free network, and if you luckily own a ssh accessible account on a server that is hosted in a free country, congratulations, you can use ssh tunnel to fuck the wall.</p>




<p>Seriously, you just need to install ssh tool on your PC, (it will be much easier to setup a ssh tunnel if you are using a *nix OS), putty is a good choose if you are on Windows. I will show the script to explain what you should do on Ubuntu 9.04.
<pre name="code" class="ruby">
   ssh -qTfnN -D LocalPort remotehost(dreamhost)
</pre>
<code>
All the added options are for a ssh session that’s used for tunneling.<br />
-q :- be very quite, we are acting only as a tunnel.<br />
-T :- Do not allocate a pseudo tty, we are only acting a tunnel.<br />
-f :- move the ssh process to background, as we don’t want to interact with this ssh session directly.<br />
-N :- Do not execute remote command.<br />
-n :- redirect standard input to /dev/null.<br />
In addition on a slow line you can gain performance by enabling compression with the -C option.
</code>
 Enjoy it.</p>

</div>
  <footer>
    <a rel="full-article" href="/2009/11/03/ssh-turnl-script/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/11/03/polymorphic-association-in-factory_girl/">Polymorphic Association in Factory_girl</a></h1>
    
    
      <p class="meta">




<time datetime="2009-11-03 00:00:00 +0800" pubdate  updated >Nov 3<span>rd</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p>I tried factroy_girl yesterday to work with rspec framework, It&#8217;s excellent way to support testing, however, the polymorphic association in factroy_girl almost defeated me.<br />
The factory definition in my code is as:
<pre name="code" class="ruby">
Factory.define :item do |i|
    i.status 0
    i.related_with_id 1
    i.association :unit
end</pre></p>




<p>Factory.define :study_record do |sr|<br />
    sr.association :content, :factory => :item<br />
    sr.add_attribute :interaction_id<br />
    sr.add_attribute :finished_at<br />
end

Then I did this:
<pre name="code" class="ruby" /></p>




<p>    @item = Factory(:item)<br />
    @study_record = Factory(:study_record)<br />
    @item.study_records << @study_record</p>

<p>
But actually, this does not work to associate @study_record with @item, the problem is that @study_record.content is totally a new instance of Item rather than @item. It seems that "<<" doesn't work in this case.<br />
The right way to do so:
<pre name="code" class="ruby" /></p>

<p>     @item = Factory(:item)<br />
    @study_record = Factory(:study_record, :content => @item)</p>

<p>
Polymorphic association works, and it's better than the fixtures solution indeed.</p>

</div>
  <footer>
    <a rel="full-article" href="/2009/11/03/polymorphic-association-in-factory_girl/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/08/22/%E5%AF%82%E5%AF%9E%E6%98%AF%E4%B8%80%E5%BA%A7%E8%8A%B1%E5%9B%AD/">寂寞是一座花园</a></h1>
    
    
      <p class="meta">




<time datetime="2009-08-22 00:00:00 +0800" pubdate  updated >Aug 22<span>nd</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p><div align="center"><font color="#262626"><b><a href="http://wangyaodi.com">Thoughts Refactoring</a><br /><br />- eNd -<br /></b></font></div></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/08/22/%E5%AF%82%E5%AF%9E%E6%98%AF%E4%B8%80%E5%BA%A7%E8%8A%B1%E5%9B%AD/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/08/05/%E5%85%AB%E6%9C%88/">八月</a></h1>
    
    
      <p class="meta">




<time datetime="2009-08-05 00:00:00 +0800" pubdate  updated >Aug 5<span>th</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p><span>&quot;习惯就是习惯，扔不出窗外，只能步步引下楼。&quot;<br /><br />人们总以为自己变得更好，却不知道处在那一点才是真的好，于是人生的后退也一样华丽。<br />碰到感动的场面开始平静而泰然，愤怒的时候热切，思念的时候寡淡。<br /><br />遇见对手是一件豪迈的事情，酒剩下一杯，心事两份。<br />旅途延伸，背包里是我向往的心。只要一个谎言，我成全了你所有的美丽。<br /><br />最后，我告诉她，一个人经常说自己如何忙，那是无能的表现。<br /></span></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/08/05/%E5%85%AB%E6%9C%88/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/30/%E4%BF%A1%E4%BB%B0%E5%9C%A8%E7%A9%BA%E4%B8%AD%E9%A3%98%E6%89%AC/">信仰在空中飘扬</a></h1>
    
    
      <p class="meta">




<time datetime="2009-07-30 00:00:00 +0800" pubdate  updated >Jul 30<span>th</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p>春天里<br />破碎的歌谣<br /><br />母亲<br />光明<br /><br />无主之城<br />空空如野<br /><br />当我想你的时候<br />你是我心爱的姑娘<br /><br />如果风不再吹<br />名利场<br />蹩脚的爱情<br /><br />有意思吗<br />再见青春<br /><a target="_blank" href="http://www.google.cn/music/album?id=Bc5f392dca49ef9bc">信仰在空中飘扬</a><br /><br /></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/07/30/%E4%BF%A1%E4%BB%B0%E5%9C%A8%E7%A9%BA%E4%B8%AD%E9%A3%98%E6%89%AC/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/28/%E4%BD%A0%E7%9A%84%E7%94%9F%E6%97%A5%E8%AE%A9%E6%88%91%E6%83%B3%E8%B5%B7%E4%B8%80%E4%B8%AA%E5%BE%88%E4%B9%85%E4%BB%A5%E5%89%8D%E7%9A%84%E6%9C%8B%E5%8F%8B/">你的生日让我想起一个很久以前的朋友</a></h1>
    
    
      <p class="meta">




<time datetime="2009-07-28 00:00:00 +0800" pubdate  updated >Jul 28<span>th</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p>感冒四天<br />困倦弥漫了整个空间<br />而我依然想说<br />要快乐<br />万安<br /></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/07/28/%E4%BD%A0%E7%9A%84%E7%94%9F%E6%97%A5%E8%AE%A9%E6%88%91%E6%83%B3%E8%B5%B7%E4%B8%80%E4%B8%AA%E5%BE%88%E4%B9%85%E4%BB%A5%E5%89%8D%E7%9A%84%E6%9C%8B%E5%8F%8B/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/20/%E6%B4%AA%E6%B0%B4%E7%8C%9B%E5%85%BD/">洪水猛兽</a></h1>
    
    
      <p class="meta">




<time datetime="2009-07-20 00:00:00 +0800" pubdate  updated >Jul 20<span>th</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p><font color="#595959"><b>突然意识到自己失眠了。<br />躺下一个小时，翻来覆去。接着窗外开始有淅淅沥沥的雨声，像是在与我倾诉。<br />从床上坐起来，点一跟烟，走到窗前。雨声密密麻麻，像是我的心事。<br /><br />脑子空白了很久，表情恐怕也凝固在黑暗中，而却无力去调整，那怕一个姿势，或者仅仅是将凝视的眼神转一个方向。<br />半年的时间里，还未曾如此溺爱自己，让夜尽情穿透理智，爱这样的夜，我也憎恨它。<br /><br />我不是在思念，是寂寞。<br /><br />鲜活和狰狞同时装点着故事的每一个细节，温润是个骗局，而信任终究无解。<br />跋涉夸大了美景，无知永远无敌。<br /><br />有一天，以正义正名。<br />而所有剧终，都满是惶恐。</b></font></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/07/20/%E6%B4%AA%E6%B0%B4%E7%8C%9B%E5%85%BD/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/18/%E6%97%A0%E9%A2%98-12/">无题</a></h1>
    
    
      <p class="meta">




<time datetime="2009-07-18 00:00:00 +0800" pubdate  updated >Jul 18<span>th</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p><i>低调而安静<br />成了生活的主旋律<br /><br />仍然无题<br />&amp;TO BE CONTINUED..</i><br /></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/07/18/%E6%97%A0%E9%A2%98-12/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2009/07/13/%E6%97%A0%E9%A2%98-11/">无题</a></h1>
    
    
      <p class="meta">




<time datetime="2009-07-13 00:00:00 +0800" pubdate  updated >Jul 13<span>th</span>, 2009</time>


</p>
    
  </header>


  <div class="entry-content"><p><span style="font-weight:bold;font-style:italic">永远都是这样子</span><br style="font-weight:bold;font-style:italic" /><span style="font-weight:bold;font-style:italic">因为你永远不知道下一次<br />又会是什么事情</span><br style="font-weight:bold;font-style:italic" /><br style="font-weight:bold;font-style:italic" /><span style="font-weight:bold;font-style:italic">后来<br />我的生活就跟着改变了</span></p>

</div>
  <footer>
    <a rel="full-article" href="/2009/07/13/%E6%97%A0%E9%A2%98-11/">Read on &rarr;</a>
  </footer>


  </article>

<nav role="pagination">
  <div>
    
      <a class="prev" href="/page21/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
      <a class="next" href="/page19/">Newer &rarr;</a>
    
  </div>
</nav>

<script type="text/javascript">
    var disqus_shortname = 'andyspersonalblog';
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>
<aside role=sidebar>
  
    <section>
  <img src="http://farm8.staticflickr.com/7401/8772484013_a1af7dc483_o.jpg"></img>
  <p><b style="color:red">安迪</b><br />
     <b style="color:red">西安</b>, 中国 <br />
     <b style="color:red">自由职业</b> at <a href="http://intridea.com">Intridea</a></p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/12/06/31-years-old/">31岁了</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/01/xian-rubyists-on-trello/">如何用Trello组织西安Rubyists聚会</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/21/be-open-to-express-yourself/">从容表达</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/20/remote-working/">远程工作那些事儿</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/17/xian-rubyists-party-v2/">西安Rubyists线下活动通知[20130720]</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/07/on-the-road/">在路上</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/05/bookclub/">读书俱乐部</a>
      </li>
    
      <li class="post">
        <a href="/2013/06/25/random-thoughts/">莫愁前路无知己</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>新浪微博</h1>
  <ul id="weibo">
    <li>
      <iframe 
        width="100%" 
        height="550" 
        class="share_self" 
        frameborder="0" 
        scrolling="no" 
        src="http://widget.weibo.com/weiboshow/index.php?width=0&height=550&ptype=1&speed=0&skin=&isTitle=0&noborder=1&isWeibo=1&isFans=&uid=1692318703&verifier=27e84cd9&dpc=1">
      </iframe>
    </li>
  </ul>
</section>


  
</aside>

    </div>
  </div>
  <footer><p>
  Copyright &copy; 2013 - Andy Wang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
